import { createAction, handleActions } from "redux-actions";
import produce from "immer";
import moment from "moment"
import api from "../../api/api"

// actions

const ONE_PRODUCT = "ONE_PRODUCT";
const GET_PRODUCT = "GET_PRODUCT";


// action creators


const oneProduct = createAction(ONE_PRODUCT, (post)=>({post}));
const getProduct = createAction(GET_PRODUCT, (post_list) => ({ post_list }));


// initial state

const initialState = {
productId : 0,
productNam : "플레인요거트",
price : 5000,
desc: "장에 좋은 요거트",
productImg : "https://media.istockphoto.com/photos/dog-puppy-on-garden-picture-id1142412984?k=20&m=1142412984&s=170667a&w=0&h=VLomTUSZwXDrVauJrpiyMboe0Q7lUYYiMO89sFy2dgY="
    
};


//미들웨어

const getProductMK = () => {
    return async function (dispatch, getState) {
        const token = localStorage.getItem('token');
        await api.get('/api/post_list',{
            headers: {
                Authorization:
                    `${token}`
            }
        }
        )
            .then((response) => {
                //console.log("LikePst",response.data.sortByLike);
                 dispatch(getProduct(response));
                 
            }).catch((err) => {
                console.log(err);
            })
    }
}
const getOneProduct = (postid) => {
    return async function (dispatch, useState, {history}){
      await api.get(`/api/detail/${postid}`).then(function(response){
        console.log("하나 받아라",response);
        dispatch(oneProduct(response));
      })
    }
  }



// reducer
export default handleActions(
    {
        
        
           [ONE_PRODUCT] : (state, action) => produce(state,(draft) => {
            
            console.log("액션에서 받아라",action.payload.post)
            draft.one_post = action.payload.post
          }),
           [GET_PRODUCT]: (state, action) => produce(state, (draft) => {
            draft.list = action.payload.post_list;
            //console.log("draft.list",draft.list)
        }),

    },
    initialState
);
const actionCreators = {
    
    getOneProduct,
    getProductMK
};

export { actionCreators };